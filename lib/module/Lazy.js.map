{"version":3,"names":["React","StyleSheet","Animated","useSharedValue","useAnimatedReaction","runOnJS","useDerivedValue","withTiming","useAnimatedStyle","ScrollView","useScroller","useTabNameContext","useTabsContext","Lazy","children","startMounted","cancelLazyFadeIn","raw","name","focusedTab","refMap","scrollY","tabNames","canMount","setCanMount","useState","afterMount","setAfterMount","isSelfMounted","useRef","opacity","useEffect","current","allowToMount","useCallback","setTimeout","value","focused","scrollTo","ref","tabIndex","findIndex","n","stylez","styles","container","create","flex"],"sources":["Lazy.tsx"],"sourcesContent":["import React from 'react'\nimport { StyleSheet } from 'react-native'\nimport Animated, {\n  useSharedValue,\n  useAnimatedReaction,\n  runOnJS,\n  useDerivedValue,\n  withTiming,\n  useAnimatedStyle,\n} from 'react-native-reanimated'\n\nimport { ScrollView } from './ScrollView'\nimport { useScroller, useTabNameContext, useTabsContext } from './hooks'\n\n/**\n * Typically used internally, but if you want to mix lazy and regular screens you can wrap the lazy ones with this component.\n */\nexport const Lazy: React.FC<{\n  startMounted?: boolean\n  cancelLazyFadeIn?: boolean\n  children: React.ReactElement\n  raw?: boolean\n}> = ({ children, startMounted, cancelLazyFadeIn, raw }) => {\n  const name = useTabNameContext()\n  const { focusedTab, refMap, scrollY, tabNames } = useTabsContext()\n  const [canMount, setCanMount] = React.useState(!!startMounted)\n  const [afterMount, setAfterMount] = React.useState(!!startMounted)\n  const isSelfMounted = React.useRef(true)\n\n  const opacity = useSharedValue(cancelLazyFadeIn || startMounted ? 1 : 0)\n\n  React.useEffect(() => {\n    return () => {\n      isSelfMounted.current = false\n    }\n  }, [])\n\n  const allowToMount = React.useCallback(() => {\n    // wait the scene to be at least 50 ms focused, before mounting\n    setTimeout(() => {\n      if (focusedTab.value === name) {\n        if (isSelfMounted.current) setCanMount(true)\n        // we need to wait for the children rendering to complete so that we can scroll properly\n        setTimeout(() => {\n          if (isSelfMounted.current) setAfterMount(true)\n        }, 10)\n      }\n    }, 50)\n  }, [focusedTab.value, name])\n\n  useAnimatedReaction(\n    () => {\n      return focusedTab.value === name\n    },\n    (focused) => {\n      if (focused && !canMount) {\n        runOnJS(allowToMount)()\n      }\n    },\n    [canMount, focusedTab]\n  )\n\n  const scrollTo = useScroller()\n\n  const ref = name ? refMap[name] : null\n\n  useDerivedValue(() => {\n    if (afterMount) {\n      const tabIndex = tabNames.value.findIndex((n) => n === name)\n      if (ref && tabIndex >= 0 && !raw) {\n        scrollTo(ref, 0, scrollY.value[tabIndex], false, `[${name}] lazy sync`)\n      }\n      if (!cancelLazyFadeIn && opacity.value !== 1)\n        opacity.value = withTiming(1)\n    }\n  }, [ref, cancelLazyFadeIn, opacity, name, afterMount, tabNames, scrollTo])\n\n  const stylez = useAnimatedStyle(() => {\n    return {\n      opacity: opacity.value,\n    }\n  }, [])\n\n  return canMount ? (\n    cancelLazyFadeIn ? (\n      children\n    ) : (\n      <Animated.View\n        pointerEvents=\"box-none\"\n        style={[styles.container, !cancelLazyFadeIn && stylez]}\n      >\n        {children}\n      </Animated.View>\n    )\n  ) : (\n    <ScrollView />\n  )\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n})\n"],"mappings":"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"}